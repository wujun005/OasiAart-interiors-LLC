# 新需求开发指南

本文档说明如何使用项目宪章和规范化的流程来开发新功能需求。

## 📋 开发流程概览

```
1. 创建新功能分支和规格文档
   ↓
2. 编写功能规格说明 (spec.md)
   ↓
3. 创建实施计划 (plan.md)
   ↓
4. 创建任务清单 (tasks.md)
   ↓
5. 按照任务清单开发，遵循项目宪章原则
   ↓
6. 代码审查和测试
```

## 🚀 详细步骤

### 步骤 1: 创建新功能分支

使用脚本创建新功能分支和初始文档：

```bash
# 基本用法
cd /Users/gmliang/projects/xxx/OasiAart-interiors-LLC
bash .specify/scripts/bash/create-new-feature.sh "你的功能描述"

# 示例：创建一个用户认证功能
bash .specify/scripts/bash/create-new-feature.sh "添加用户登录和注册功能"
# 生成分支名：001-user-login-registration

# 自定义分支名称（推荐，更简洁）
bash .specify/scripts/bash/create-new-feature.sh "添加购物车功能" --short-name "shopping-cart"
# 生成分支名：002-shopping-cart

# 手动指定编号（如果需要特定编号）
bash .specify/scripts/bash/create-new-feature.sh "添加支付功能" --short-name "payment" --number 5
# 生成分支名：005-payment
```

**脚本会：**
- 自动创建功能分支（格式：`001-feature-name`，三位数字前缀 + 短横线 + 功能名）
- 在 `specs/` 目录下创建功能目录（目录名与分支名相同）
- 复制规格模板到 `specs/001-user-authentication/spec.md`（示例）
- 设置环境变量 `SPECIFY_FEATURE` 为分支名

**分支命名规范说明：**
- **编号部分**（001-999）：三位数字，自动递增，确保唯一性
- **名称部分**：英文小写，使用短横线分隔，例如：
  - ✅ 正确：`001-user-authentication`、`002-product-catalog`、`003-shopping-cart`
  - ❌ 错误：`001_user_auth`（使用下划线）、`001-UserAuth`（有大写字母）、`1-user-auth`（数字不是三位）
- 建议使用 `--short-name` 参数自定义简洁的名称，避免自动生成过长的分支名

### 步骤 2: 编写功能规格说明 (spec.md)

编辑功能目录下的 `spec.md` 文件（例如：`specs/001-user-authentication/spec.md`），填写以下内容：

1. **用户场景和测试用例** (必须)
   - 按优先级（P1, P2, P3...）列出用户故事
   - 每个故事必须可独立测试
   - 使用 Given-When-Then 格式编写验收场景

2. **功能需求** (必须)
   - 列出所有功能需求（FR-001, FR-002...）
   - 使用 MUST/SHOULD/MAY 明确需求级别
   - 标记需要澄清的需求（NEEDS CLARIFICATION）

3. **关键实体** (如涉及数据)
   - 定义数据模型和实体关系

4. **成功标准** (必须)
   - 定义可测量的成功指标

**示例：**
```markdown
### User Story 1 - 用户登录 (Priority: P1)

用户可以通过邮箱和密码登录系统

**验收场景**:
1. **Given** 用户已注册账户, **When** 输入正确的邮箱和密码, **Then** 登录成功并跳转到首页
2. **Given** 用户输入错误密码, **When** 点击登录, **Then** 显示错误提示信息
```

### 步骤 3: 创建实施计划 (plan.md)

使用 `/speckit.plan` 命令（如果配置了 Cursor 命令）或手动创建：

```bash
# 如果配置了 Cursor 命令
/speckit.plan
```

**计划文档应包含：**

1. **技术上下文**
   - 技术栈和依赖
   - 项目结构
   - 性能目标和约束

2. **项目宪章检查**
   - 确认功能符合项目宪章的 10 条原则
   - 如有违反，必须说明理由

3. **项目结构**
   - 源代码目录结构
   - 文档目录结构

4. **复杂度跟踪**
   - 如有违反宪章的情况，说明原因

### 步骤 4: 创建任务清单 (tasks.md)

使用 `/speckit.tasks` 命令或手动创建：

**任务组织方式：**

- **Phase 1: 设置阶段** - 项目初始化和基础结构
- **Phase 2: 基础阶段** - 核心基础设施（所有用户故事的基础）
- **Phase 3+: 用户故事阶段** - 按优先级逐个实现用户故事
- **Phase N: 完善阶段** - 跨功能改进和优化

**任务格式：**
```
- [ ] T001 [P] [US1] 任务描述
```

- `[P]` = 可并行执行（不同文件，无依赖）
- `[US1]` = 所属用户故事编号
- 任务编号 = T001, T002...

### 步骤 5: 开始开发

按照任务清单逐项完成，**必须遵循项目宪章的原则**：

#### ✅ 检查清单 - 每个任务完成后确认：

- [ ] 使用 TypeScript，无 `any` 类型
- [ ] 代码按模块组织（client/admin 分离）
- [ ] 组件使用 Composition API 和 `<script setup>`
- [ ] 所有用户可见文本使用 i18n（不硬编码中文）
- [ ] 路由配置了 meta 信息（scope, requiresAuth 等）
- [ ] 状态管理使用 Pinia，通过 actions 修改状态
- [ ] API 请求使用封装的 request 工具
- [ ] 代码符合 ESLint/Prettier 规范
- [ ] 路由使用懒加载
- [ ] 用户输入进行了验证和清理

#### 🎯 MVP 优先策略

1. 先完成 Phase 1 和 Phase 2
2. 实现 P1 优先级的用户故事（MVP）
3. **停止并验证** - 确保 MVP 功能完整可用
4. 然后逐步添加 P2、P3 的用户故事

#### 📝 提交规范

- 每个任务或逻辑组完成后提交
- 提交信息清晰描述变更内容
- 提交前检查是否违反项目宪章

### 步骤 6: 代码审查

在合并前进行代码审查，检查：

- ✅ 是否符合项目宪章的所有原则
- ✅ 是否通过 TypeScript 类型检查
- ✅ 是否通过 ESLint 检查
- ✅ 功能是否满足 spec.md 中的验收场景
- ✅ 是否有适当的错误处理

## 📁 项目结构

开发完成后，功能相关的文档结构如下：

```
specs/001-user-authentication/
├── spec.md              # 功能规格说明
├── plan.md              # 实施计划
├── research.md          # 技术调研（如有）
├── data-model.md        # 数据模型（如有）
├── quickstart.md        # 快速开始指南（如有）
├── contracts/           # API 契约（如有）
└── tasks.md             # 任务清单
```

**示例说明：**
- `001` 是功能编号（自动递增）
- `user-authentication` 是功能名称（英文，使用短横线分隔）
- 完整的目录名和分支名格式：`001-user-authentication`

## 🔍 参考文档

- **项目宪章**: `.specify/memory/constitution.md` - 开发必须遵循的原则
- **规格模板**: `.specify/templates/spec-template.md`
- **计划模板**: `.specify/templates/plan-template.md`
- **任务模板**: `.specify/templates/tasks-template.md`

## 💡 常见问题

### Q: 如何确定用户故事的优先级？

A: 
- **P1（MVP）**: 核心功能，没有这个功能产品无法使用
- **P2**: 重要功能，增强用户体验
- **P3**: 锦上添花的功能，可有可无

### Q: 如果我的功能违反了项目宪章的某条原则怎么办？

A: 
1. 首先尝试找到符合宪章的替代方案
2. 如果确实需要违反，在 plan.md 的"复杂度跟踪"部分说明：
   - 为什么需要违反
   - 为什么没有更简单的替代方案
   - 是否应该考虑更新项目宪章

### Q: 可以跳过某些步骤吗？

A: 
- **不能跳过 spec.md** - 这是功能的基础定义
- 对于简单功能，plan.md 可以简化，但必须包含宪章检查
- tasks.md 可以根据实际情况调整详细程度

### Q: 如何确保代码符合项目宪章？

A: 
- 开发前阅读项目宪章
- 每个任务完成后使用检查清单
- 代码审查时重点关注宪章合规性
- 使用 TypeScript、ESLint、Prettier 等工具自动检查

## 📞 获取帮助

如有问题，请：
1. 查阅项目宪章了解原则
2. 查看模板文件了解格式要求
3. 参考现有功能实现作为示例

